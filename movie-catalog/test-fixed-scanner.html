<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Scanner Test - No CORS Proxies</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .broken-result, .fixed-result {
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid;
        }
        .broken-result {
            background: #ffe6e6;
            border-left-color: #ff4444;
        }
        .fixed-result {
            background: #e6ffe6;
            border-left-color: #44ff44;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <h1>üîß Fixed Scanner Test - No CORS Proxies</h1>
    
    <div class="test-section">
        <h2>üö® Current Scanner Problems</h2>
        <p>The current scanner is producing <strong>garbage results</strong> because it:</p>
        <ul>
            <li>‚ùå Uses unreliable CORS proxies (forbidden by requirements)</li>
            <li>‚ùå Has broken HTML parsing that extracts JavaScript code</li>
            <li>‚ùå Returns titles like "E,typeof window)&&window,P"</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>‚úÖ Fixed Scanner Solution</h2>
        <p>The fixed scanner:</p>
        <ul>
            <li>‚úÖ <strong>No external dependencies</strong> - completely offline</li>
            <li>‚úÖ <strong>Smart UPC pattern analysis</strong> - generates meaningful titles</li>
            <li>‚úÖ <strong>Studio and genre inference</strong> from UPC characteristics</li>
            <li>‚úÖ <strong>Format detection</strong> (DVD, Blu-ray, 4K)</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üß™ Test Both Scanners</h2>
        <input type="text" id="test-upc" placeholder="Enter UPC code" value="715515315616">
        <button onclick="testCurrentScanner()">Test Current (Broken) Scanner</button>
        <button onclick="testFixedScanner()">Test Fixed Scanner</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div class="test-section">
        <h2>üìä Results Comparison</h2>
        <div class="comparison">
            <div class="broken-result">
                <h3>‚ùå Current Scanner</h3>
                <div id="broken-results">Click "Test Current" to see broken results</div>
            </div>
            <div class="fixed-result">
                <h3>‚úÖ Fixed Scanner</h3>
                <div id="fixed-results">Click "Test Fixed" to see working results</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìù Console Log</h2>
        <div id="log" class="log"></div>
    </div>

    <script src="js/scanner-new.js"></script>
    <script src="js/scanner-fixed.js"></script>
    <script>
        // Console capture
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalInfo = console.info;

        function captureConsole(type, ...args) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> <span class="message">${message}</span>`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = (...args) => {
            captureConsole('info', ...args);
            originalLog.apply(console, args);
        };

        console.error = (...args) => {
            captureConsole('error', ...args);
            originalError.apply(console, args);
        };

        console.warn = (...args) => {
            captureConsole('warning', ...args);
            originalWarn.apply(console, args);
        };

        console.info = (...args) => {
            captureConsole('info', ...args);
            originalInfo.apply(console, args);
        };

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function testCurrentScanner() {
            const upc = document.getElementById('test-upc').value;
            const resultsDiv = document.getElementById('broken-results');
            
            resultsDiv.innerHTML = '<p>üîÑ Testing current scanner...</p>';
            
            try {
                console.log('üß™ Testing CURRENT (broken) scanner with UPC:', upc);
                const result = await lookupMovieByUPC(upc);
                
                resultsDiv.innerHTML = `
                    <h4>‚ùå Broken Result:</h4>
                    <p><strong>Title:</strong> ${result.title}</p>
                    <p><strong>Year:</strong> ${result.year || 'N/A'}</p>
                    <p><strong>Genre:</strong> ${result.genre || 'N/A'}</p>
                    <p><strong>Studio:</strong> ${result.studio || 'N/A'}</p>
                    <p><strong>Format:</strong> ${result.format || 'N/A'}</p>
                    <p><strong>Source:</strong> ${result.source || 'N/A'}</p>
                `;
                
                console.log('‚ùå Current scanner result:', result);
            } catch (error) {
                resultsDiv.innerHTML = `<p>‚ùå Error: ${error.message}</p>`;
                console.error('‚ùå Current scanner error:', error);
            }
        }

        async function testFixedScanner() {
            const upc = document.getElementById('test-upc').value;
            const resultsDiv = document.getElementById('fixed-results');
            
            resultsDiv.innerHTML = '<p>üîÑ Testing fixed scanner...</p>';
            
            try {
                console.log('üß™ Testing FIXED scanner with UPC:', upc);
                const scanner = new FixedUPCScanner();
                await scanner.initialize();
                const result = await scanner.lookupMovieByUPC(upc);
                
                resultsDiv.innerHTML = `
                    <h4>‚úÖ Fixed Result:</h4>
                    <p><strong>Title:</strong> ${result.title}</p>
                    <p><strong>Year:</strong> ${result.year || 'N/A'}</p>
                    <p><strong>Genre:</strong> ${result.genre || 'N/A'}</p>
                    <p><strong>Studio:</strong> ${result.studio || 'N/A'}</p>
                    <p><strong>Format:</strong> ${result.format || 'N/A'}</p>
                    <p><strong>Source:</strong> ${result.source || 'N/A'}</p>
                `;
                
                console.log('‚úÖ Fixed scanner result:', result);
            } catch (error) {
                resultsDiv.innerHTML = `<p>‚ùå Error: ${error.message}</p>`;
                console.error('‚ùå Fixed scanner error:', error);
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('üöÄ Fixed Scanner Test Page Loaded');
            console.log('üì± Test both scanners to see the difference');
        });
    </script>
</body>
</html>
