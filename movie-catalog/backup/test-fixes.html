<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Catalog - UPC Search Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 3px;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .upc-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
            margin-right: 10px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Movie Catalog - UPC Search Test</h1>
        <p>This page tests the improved UPC search functionality and error handling.</p>
        
        <div class="test-section">
            <h3>üîç UPC Search Test</h3>
            <p>Test UPC search with sample codes:</p>
            <input type="text" id="upc-input" class="upc-input" placeholder="Enter UPC code" value="826663153750">
            <button class="test-button" onclick="testUPCSearch()">Search UPC</button>
            <button class="test-button" onclick="testSampleUPCs()">Test Sample UPCs</button>
            <div id="search-results"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä Spreadsheet Manager Test</h3>
            <p>Test spreadsheet functionality:</p>
            <button class="test-button" onclick="testSpreadsheetManager()">Test Spreadsheet Manager</button>
            <button class="test-button" onclick="testFilePermissions()">Test File Permissions</button>
            <div id="spreadsheet-results"></div>
        </div>
        
        <div class="test-section">
            <h3>üõ†Ô∏è Error Handling Test</h3>
            <p>Test error handling and fallback mechanisms:</p>
            <button class="test-button" onclick="testErrorHandling()">Test Error Handling</button>
            <button class="test-button" onclick="testFallbackTitles()">Test Fallback Titles</button>
            <div id="error-results"></div>
        </div>
        
        <div id="status" class="status info" style="display: none;"></div>
    </div>

    <script src="js/scanner-new.js"></script>
    <script src="js/spreadsheet-manager.js"></script>
    
    <script>
        // Test UPC search functionality
        async function testUPCSearch() {
            const upc = document.getElementById('upc-input').value.trim();
            if (!upc) {
                showStatus('Please enter a UPC code', 'error');
                return;
            }
            
            showStatus(`Searching for UPC: ${upc}...`, 'info');
            
            try {
                const result = await lookupMovieByUPC(upc);
                displaySearchResult(result, 'search-results');
                showStatus(`Search completed for UPC: ${upc}`, 'success');
            } catch (error) {
                showStatus(`Search failed: ${error.message}`, 'error');
                console.error('UPC search error:', error);
            }
        }
        
        // Test with sample UPCs
        async function testSampleUPCs() {
            const sampleUPCs = [
                '826663153750', // UHF (25th Anniversary)
                '826663249453', // Tommy
                '111515315616', // Test UPC 1
                '715515315616'  // Test UPC 2
            ];
            
            showStatus('Testing sample UPCs...', 'info');
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = '<h4>Sample UPC Test Results:</h4>';
            
            for (const upc of sampleUPCs) {
                try {
                    const result = await lookupMovieByUPC(upc);
                    displaySearchResult(result, 'search-results', true);
                    await new Promise(resolve => setTimeout(resolve, 500)); // Rate limiting
                } catch (error) {
                    console.error(`Error searching UPC ${upc}:`, error);
                }
            }
            
            showStatus('Sample UPC testing completed', 'success');
        }
        
        // Test spreadsheet manager
        function testSpreadsheetManager() {
            const resultsDiv = document.getElementById('spreadsheet-results');
            resultsDiv.innerHTML = '<h4>Spreadsheet Manager Test:</h4>';
            
            try {
                // Test if SpreadsheetManager class exists
                if (typeof SpreadsheetManager !== 'undefined') {
                    const manager = new SpreadsheetManager();
                    addResult(resultsDiv, '‚úÖ SpreadsheetManager class loaded successfully', 'success');
                    addResult(resultsDiv, `Manager instance created: ${manager.constructor.name}`, 'success');
                    addResult(resultsDiv, `Initial movie count: ${manager.getMovieCount()}`, 'info');
                } else {
                    addResult(resultsDiv, '‚ùå SpreadsheetManager class not found', 'error');
                }
            } catch (error) {
                addResult(resultsDiv, `‚ùå Error testing SpreadsheetManager: ${error.message}`, 'error');
            }
        }
        
        // Test file permissions
        function testFilePermissions() {
            const resultsDiv = document.getElementById('spreadsheet-results');
            resultsDiv.innerHTML = '<h4>File Permissions Test:</h4>';
            
            // Check if File System Access API is available
            if ('showOpenFilePicker' in window) {
                addResult(resultsDiv, '‚úÖ File System Access API available', 'success');
                addResult(resultsDiv, '‚úÖ File picker supported', 'success');
            } else {
                addResult(resultsDiv, '‚ùå File System Access API not available', 'error');
                addResult(resultsDiv, '‚ö†Ô∏è Browser may not support direct file access', 'warning');
            }
            
            // Check if we can create writable streams
            if ('createWritable' in FileSystemFileHandle?.prototype) {
                addResult(resultsDiv, '‚úÖ createWritable method available', 'success');
            } else {
                addResult(resultsDiv, '‚ùå createWritable method not available', 'error');
            }
        }
        
        // Test error handling
        function testErrorHandling() {
            const resultsDiv = document.getElementById('error-results');
            resultsDiv.innerHTML = '<h4>Error Handling Test:</h4>';
            
            // Test with invalid UPC
            try {
                const result = lookupMovieByUPC('invalid');
                addResult(resultsDiv, '‚úÖ Invalid UPC handled gracefully', 'success');
            } catch (error) {
                addResult(resultsDiv, `‚ùå Invalid UPC caused error: ${error.message}`, 'error');
            }
            
            // Test with empty UPC
            try {
                const result = lookupMovieByUPC('');
                addResult(resultsDiv, '‚úÖ Empty UPC handled gracefully', 'success');
            } catch (error) {
                addResult(resultsDiv, `‚ùå Empty UPC caused error: ${error.message}`, 'error');
            }
        }
        
        // Test fallback title generation
        function testFallbackTitles() {
            const resultsDiv = document.getElementById('error-results');
            resultsDiv.innerHTML = '<h4>Fallback Title Test:</h4>';
            
            const testUPCs = [
                '123456789012', // 12-digit
                '1234567890123', // 13-digit
                '826663153750'   // Real movie UPC
            ];
            
            testUPCs.forEach(upc => {
                try {
                    const title = generateTitleFromUPC(upc);
                    const smartTitle = generateSmartTitle(upc);
                    
                    addResult(resultsDiv, `UPC ${upc}:`, 'info');
                    addResult(resultsDiv, `  Basic: ${title}`, 'info');
                    addResult(resultsDiv, `  Smart: ${smartTitle}`, 'info');
                } catch (error) {
                    addResult(resultsDiv, `‚ùå Error with UPC ${upc}: ${error.message}`, 'error');
                }
            });
        }
        
        // Helper functions
        function displaySearchResult(result, containerId, append = false) {
            const container = document.getElementById(containerId);
            if (!append) {
                container.innerHTML = '<h4>Search Results:</h4>';
            }
            
            if (result) {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>UPC:</strong> ${result.upc}<br>
                    <strong>Title:</strong> ${result.title}<br>
                    <strong>Year:</strong> ${result.year || 'Unknown'}<br>
                    <strong>Format:</strong> ${result.format || 'Unknown'}<br>
                    <strong>Director:</strong> ${result.director || 'Unknown'}<br>
                    <strong>Genre:</strong> ${result.genre || 'Unknown'}
                `;
                container.appendChild(resultDiv);
            } else {
                addResult(container, 'No results found', 'warning');
            }
        }
        
        function addResult(container, message, type = 'info') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
            container.appendChild(resultDiv);
        }
        
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('Test page loaded successfully. Ready to test UPC search functionality.', 'success');
        });
    </script>
</body>
</html> 